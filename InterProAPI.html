<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>InterPro API</title>

    <link rel="stylesheet" href="css/reveal.css" />
    <link rel="stylesheet" href="css/theme/ebi.css" id="theme" />

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css" />

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement("link");
      link.rel = "stylesheet";
      link.type = "text/css";
      link.href = window.location.search.match(/print-pdf/gi)
        ? "css/print/pdf.css"
        : "css/print/paper.css";
      document.getElementsByTagName("head")[0].appendChild(link);
    </script>
    <style>
      div.react2020 h3, div.react2020 h2 {
        text-transform: none;
      }
      .reveal section img {
        border: 0;
      }
    </style>
  </head>
  <body>
    <div class="reveal react2020 concave">
      <div class="slides">
        <section data-markdown style="font-size:0.8em">
          ## Welcome - webinar instructions
          
          * The webinar will start soon

          * If you have problems with sound, please try exiting GoToTraining and restarting it

          * All microphones will be muted while the trainer is speaking

          * If you have a question please use the chat box at the bottom of the GoToTraining box

          * Please complete the feedback survey which will launch at the end of the webinar

          * The webinar will be recorded and added to Train online          
        </section>
        <section
          data-markdown
          data-background="css/theme/ebi/bg_atoms.png"
          class="ebi-bg"
        >
          ## Accessing InterPro programmatically 
          ###### Part of the InterPro Webinar Series
          
          _Gustavo A. Salazar_

          ![API Image](./img/tool_api_logo.png)
        </section>
        <section data-markdown>
          ## Outline

          1. 🔲 REST API.
          2. 🔲 The `/entry` endpoint.
          3. 🔲 URL structure.
          4. 🔲 Long Lists.
          5. 🔲 Mixing endpoints.
          6. 🔲 Programmatic Access.

        </section>
        <section data-markdown>
          ## A REST API

          __API__: Application programming interface

          __REST__: Representational State Transfer

          ```txt
            [ Client ]
              ||    /\
          URL ||    || JSON
              ||    ||
              \/    ||
            [ Server ]
          ```
        </section>
        <section data-markdown>
          ## Interpro API

          https://www.ebi.ac.uk/interpro/api/

          ---

          ##### Endpoints

          1. `/entry`
          2. `/protein`
          3. `/structure`
          4. `/taxonomy`
          5. `/proteome`
          6. `/set`

        </section>
        <section data-markdown>
          ## Outline

          1. ✅ REST API.

          ---
          2. 🔲 The `/entry` endpoint.

          ---
          3. 🔲 URL structure.
          4. 🔲 Long Lists.
          5. 🔲 Mixing endpoints.
          6. 🔲 Programmatic Access.

        </section>

        <section data-markdown>
          ## The entry endpoint
          [/api/entry](https://www.ebi.ac.uk/interpro/api/entry)

          The root of the endpoint tells us the number of entries per member database
        </section>
        <section data-markdown>
          ## The entry endpoint

          [/entry/interpro](https://www.ebi.ac.uk/interpro/api/entry/interpro)
          
          Including `/interpro` as our database, has 2 effects:
          * Filters the result to only include the entries with database `interpro`
          * Displays the result as a list of entities
        </section>
        <section data-markdown>
          ## The entry endpoint

          [/entry/interpro/IPR000126](https://www.ebi.ac.uk/interpro/api/entry/interpro/IPR000126)
          
          Including `/IPR000126` as our accession, has 2 effects again:
          * Selects that entity in particular
          * Displays the result as a JSON object with the metadata of that entity
        </section>
        <section data-markdown>
          ## Outline

          1. ✅ REST API.
          2. ✅ The `/entry` endpoint.

          ---
          3. 🔲 URL structure.

          ---
          4. 🔲 Long Lists.
          5. 🔲 Mixing endpoints.
          6. 🔲 Programmatic Access.

        </section>

        <section data-markdown>
          ## URL structure
          
          All the endpoints follow the same structure.

          ---
          
          `/api/`**`[endpoint]/`**
          
          It returns an aggregated view of the endpoint, showing how many items per database.

          ---

        </section>
        <section data-markdown>
          ## URL structure
          
          All the endpoints follow the same structure.

          ---
          
          `/api/`**`[endpoint]/`** **`[database]/`** 
          
          Generates the list of items in the endpoint for the selected DB

          ---
        </section>
        <section data-markdown>
          ## URL structure
          
          All the endpoints follow the same structure.

          ---

          `/api/`**`[endpoint]/`** **`[database]/`** **`[accession]/`**  
          
          It gives the metadata of the entity with that acceession.

          ---
        </section>

        <section data-markdown>
          ## Examples

          * [/api/protein](https://www.ebi.ac.uk/interpro/api/protein)
          * [/api/proteome](https://www.ebi.ac.uk/interpro/api/proteome)
          * [/api/structure/pdb](https://www.ebi.ac.uk/interpro/api/structure/pdb)
          * [/api/set/cdd](https://www.ebi.ac.uk/interpro/api/set/cdd)
          * [/api/taxonomy/uniprot/9606](https://www.ebi.ac.uk/interpro/api/taxonomy/uniprot/9606)
          * [/api/proteome/uniprot/UP000464024/](https://www.ebi.ac.uk/interpro/api/proteome/uniprot/UP000464024/)

        </section>
        <section data-markdown>
          ## Outline

          1. ✅ REST API.
          2. ✅ The `/entry` endpoint.
          3. ✅ URL structure.

          ---
          4. 🔲 Long Lists.

          ---
          5. 🔲 Mixing endpoints.
          6. 🔲 Programmatic Access.

        </section>
        <section data-markdown>
          ## Long Lists

          When using a URL that returns a list of items. It is likely that the number of 
          results is higher than 20, which is the default size of InterPro API responses.

          e.g. [/api/entry/sfld](https://www.ebi.ac.uk/interpro/api/entry/sfld)

          ---
          You can change this value using the parameter `page_size` to a maximum of 200. 

          e.g. [/api/entry/sfld?page_size=200](https://www.ebi.ac.uk/interpro/api/entry/sfld?page_size=200)
        </section>
        <section data-markdown>
          ## Long Lists

          If the list is bigger than 200 items, then multiple HTTP requests are required
          to get the full set.

          You can get the link to the next page, from the current page in its key `next`.

          e.g. 
          [/api/entry/sfld?page_size=200](https://www.ebi.ac.uk/interpro/api/entry/sfld?page_size=200)

          ```
          {
            "next": "https://www.ebi.ac.uk/interpro/api/entry/sfld?cursor=cD1TRkxERzAxMDk1&page_size=200",
            ...
          }
          ```
          
          [Next](https://www.ebi.ac.uk/interpro/api/entry/sfld?cursor=cD1TRkxERzAxMDk1&page_size=200)
        </section>
        <section data-markdown>
          ## Long Lists

          The last page would have `null` as the `next` key value.
          ```
          {
            "next": null,
            ...
          }
          ```
        </section>
        <section data-markdown>
          ## Outline

          1. ✅ REST API.
          2. ✅ The `/entry` endpoint.
          3. ✅ URL structure.
          4. ✅ Long Lists.

          ---
          5. 🔲 Mixing endpoints.

          ---
          6. 🔲 Programmatic Access.

        </section>
        <section>
          <h2>Mixing endpoints</h2>

          <p>Interpro API allows you to use multiple endpoints.</p>

          <p>We will call <b>[ENDPOINT BLOCK]</b> the group of URL levels that relate to a particular endpoint:</p>
          <p><code>/api/</code> <code style="color:darkslateblue">[endpoint]</code> / <code style="color:slateblue">[database]</code> / <code style="color:lightslategrey">[accession]</code> /</p>

          <p>It is possible to put together more than one <b>[ENDPOINT BLOCK]</b>.</p>

          <p><code>/api/</code> <b style="color:lightcoral">[ENDPOINT BLOCK]</b> / <b style="color:olive">[ENDPOINT BLOCK]</b> /</p>
        </section>
        <section>
          <h2>Mixing endpoints</h2>

          <p><code>/api/</code> <b style="color:lightcoral">[ENDPOINT BLOCK]</b> / <b style="color:olive">[ENDPOINT BLOCK]</b> /</p>

          <ul>
            <li>The first <b style="color:lightcoral">[ENDPOINT BLOCK]</b> defines the main endpoint and output of the response. </li>
            
            <li>Any other <b style="color:olive">[ENDPOINT BLOCK]</b> will be considered as a filter.</li>
          </ul>
        </section>
        <section>
          <h2>Mixing endpoints</h2>
          <p>e.g. 
            <a href="https://www.ebi.ac.uk/interpro/api/protein/uniprot/entry/interpro/IPR000126">
              /api<span style="color:lightcoral">/protein/uniprot</span><span style="color:olive">/entry/interpro/IPR000126</span>
            </a>
          </p>

          <hr/>

          <p>Returns the list of uniprot proteins that are related (i.e. Have a match) with the interpro entry with accession <span style="color:olive">IPR000126</span>.</p>
        </section>
        <section data-markdown>
          ## Outline

          1. ✅ REST API.
          2. ✅ The `/entry` endpoint.
          3. ✅ URL structure.
          4. ✅ Long Lists.
          5. ✅ Mixing endpoints.

          ---
          6. 🔲 Programmatic Access.

          ---

        </section>
        <section data-markdown>
          ## Programmatic Access

          This is a python3 script to print out the accessions of the proteins that have a match with `IPR000126`.

```python
from urllib import request
import json

url = "https://www.ebi.ac.uk/interpro/api/protein/uniprot/entry/interpro/IPR000126"

req = request.Request(url)
res = request.urlopen(req)

payload = json.loads(res.read().decode())

for item in payload["results"]:
  print(item["metadata"]["accession"])
```
        </section>
        <section data-markdown>
          ## Programmatic Access

          This is a python3 script to print out the accessions of the proteins that have a match with `IPR000126`.

```python
from urllib import request
from time import sleep
import json

url = "https://www.ebi.ac.uk/interpro/api/protein/uniprot/entry/interpro/IPR000126?page_size=200"

while url is not None:
  req = request.Request(url)
  res = request.urlopen(req)

  payload = json.loads(res.read().decode())

  for item in payload["results"]:
    print(item["metadata"]["accession"])
  url = payload["next"]
  sleep(1)
```
        </section>
        <section data-markdown>
          ## HTTP Status Codes

          * `200`: OK
          * `204`: No Content
            [/api/structure/pdb/protein/UniProt/A0A000](https://www.ebi.ac.uk/interpro/api/structure/pdb/protein/UniProt/A0A000)
          * `404`: Not Found
            [/api/badEndpoint](https://www.ebi.ac.uk/interpro/api/badEndpoint)
          * `408`: Timeout
          * `410`: Gone
            [/api/entry/InterPro/IPR000038](https://www.ebi.ac.uk/interpro/api/entry/InterPro/IPR000038)
          * `500`: Server Error
        </section>
        <section data-markdown>
          ## InterPro API timeouts

          If a request takes longer than a minute:
          * The API will return the HTTP status code `408`.
          * The request is moved to run in the background.
          
          ___
          If you try the same URL later, the API response would be:
          * An almost instant `408`, meaning the previous query is still running, or
          * The response of the query.
        </section>
        <section data-markdown>
          ## InterPro API timeouts
```python
from urllib import request
from time import sleep
import json

url = "https://www.ebi.ac.uk/interpro/api/protein/uniprot/entry/interpro/IPR000126?page_size=200"

while url is not None:
  req = request.Request(url)
  res = request.urlopen(req)
  if res.status == 408:
    sleep(61)
    continue

  payload = json.loads(res.read().decode())

  for item in payload["results"]:
    print(item["metadata"]["accession"])
  url = payload["next"]
  sleep(1)
```
        </section>
        <section data-markdown>
          ## InterPro script generator

          We provide a starting point to create some scripts to query our API.

          You can go to the link below, select the data you are interested in, and we generate a script that you can use.

          [InterPro script generator](https://www.ebi.ac.uk/interpro/result/download/#/entry/InterPro/)

          We provide scripts in Python3, Python2, Perl and JavaScript. Generating output in TSV, FastA, or JSON.

        </section>
        <section data-markdown>
          ## Outline

          1. ✅ REST API.
          2. ✅ The `/entry` endpoint.
          3. ✅ URL structure.
          4. ✅ Long Lists.
          5. ✅ Mixing endpoints.
          6. ✅ Programmatic Access.
        </section>
        <section style="font-size:0.8em">
          <h2>Acknowledgments</h2>
          <div style="display:inline-flex; justify-content: space-evenly; width: 100%;">
            <div>
              <div>
                Hsin-Yu Chang <br/>
                Sara Chuguransky <br/>
                Lowri Williams <br/>
                Alex Mitchell <br/>
                Lorna Richardson <br/>
                Alex Bateman <br/>
                Typhaine Paysan-Lafosse <br/>
              </div>
              <br/>
              <div>
                Matloob Qureshi <br/>
                Swaathi Kandasaamy <br/>
              </div>
            </div>
            <div>
              <div>
                Gift Nuka <br/>
                Simon Potter <br/>
                Matthias Blum <br/>
              </div>
              <br/>
              <div>
                <b>Group Head:</b> <br/>
                Rob Finn<br/>
              </div>
            </div>
          </div>
          <img src="./img/logos.png" style="background:white"/>
        </section>
        <section data-markdown>
          # Thanks! 👍🏼

          https://www.ebi.ac.uk/interpro/help/documentation/

          https://gustavo-salazar.github.io/ProteinFamiliesTalks/InterProAPI.html
        </section>
        <section style="font-size:0.8em">
          <h3>Upcoming webinars</h3>
          
          <p>See the full list of upcoming webinars at 
            <a href="https://www.ebi.ac.uk/training/webinars">https://www.ebi.ac.uk/training/webinars</a>
          </p>
          <img src="./img/webinars.png" style="width:500px"/>

          <h3>Tell us your thoughts</h3>

          <p>Please fill in the survey that launches after the webinar – thanks!</p>
        </section>      
      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>
      // More info about config & dependencies:
      // - https://github.com/hakimel/reveal.js#configuration
      // - https://github.com/hakimel/reveal.js#dependencies
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: false,
        controlsLayout: "edges",
        fragments: true,

        markdown: {
          smartypants: true
        },
        dependencies: [
          { src: "plugin/markdown/marked.js" },
          { src: "plugin/markdown/markdown.js" },
          { src: "plugin/notes/notes.js", async: true },
          {
            src: "plugin/highlight/highlight.js",
            async: true,
            callback: function() {
              hljs.initHighlightingOnLoad();
            }
          }
        ]
      });
    </script>
  </body>
</html>
